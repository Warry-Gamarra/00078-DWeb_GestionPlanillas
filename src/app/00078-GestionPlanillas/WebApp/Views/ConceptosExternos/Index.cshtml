@model IEnumerable<WebApp.Models.ConceptoModel>

@Styles.Render("~/content/fileinput")
@Scripts.Render("~/bundles/fileinput")

<div class="container-fluid">
    <div class="col-12 mb-4">
        <section class="content-header">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb float-right small d-none d-sm-inline-flex">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index", "Home")"><i class="fa fa-home" aria-hidden="true">&nbsp;</i>Inicio</a></li>
                    <li class="breadcrumb-item"><span><i class="fa fa-refresh" aria-hidden="true">&nbsp;</i>Operaciones </span></li>
                    <li class="breadcrumb-item active"><span><i class="fa fa-cloud-upload" aria-hidden="true">&nbsp;</i>@ViewBag.Title </span></li>
                </ol>
            </nav>
            <h1 class="">@ViewBag.Title <small></small></h1>
        </section>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <span class="h4">Archivo externo</span>
        </div>
        <div class="card-body">
            @using (Html.BeginForm("ObtenerInformacionArchivo", "ConceptosExternos", FormMethod.Post, 
                new { id = "form-upload", enctype = "multipart/form-data", @class = "form-inline" }))
            {
                <form id="form-upload" name="form-upload" class="form-inline" enctype="multipart/form-data">
                    <div class="form-group mr-2">
                        <label class="control-label" for="inputFile">Seleccione archivo</label>
                        <input type="file" class="form-control-file" id="inputFile" name="inputFile" />
                    </div>
                    <div class="form-group mr-2">
                        @Html.AntiForgeryToken()
                        <button type="submit" id="btn-submit" class="btn btn-primary"><i class="fa fa-search" aria-hidden="true"></i> Vista previa</button>
                        <div id="wating-section" class="d-none">
                            <strong>Cargando información...</strong>
                            <div class="spinner-border ml-auto text-primary" role="status" aria-hidden="true"></div>
                        </div>
                    </div>
                </form>
            }
            <div class="form-group" id="error-matricula"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <span class="h4">Vista previa</span>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="dataTablePlantillaPlanilla" width="100%">
                    <thead class="thead-dark">
                        <tr>
                            <th>Periodo</th>
                            <th>Trabajador</th>
                            <th>Cod.Concepto</th>
                            <th>Desc.Concepto</th>
                            <th>Valor.Concepto</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>Periodo</th>
                            <th>Trabajador</th>
                            <th>Cod.Concepto</th>
                            <th>Desc.Concepto</th>
                            <th>Valor.Concepto</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $("#input_file").fileinput({
                showCaption: true,
                dropZoneEnabled: false,
                language: 'es',
                allowedFileExtensions: ["xls", "xlsx"],
                showPreview: false,
                showUpload: false,
                elErrorContainer: '#error-matricula'
            });

            $('#form-upload').on('submit', function (event) {
                event.preventDefault();
                var form = $(this);

                form.ajaxSubmit({
                    cache: false,
                    url: form.attr("action"),
                    type: "POST",
                    processData: false,
                    dataType: "json",
                    beforeSend: function () {
                        $("#btn-submit").addClass("d-none");
                        $("#wating-section").removeClass("d-none");
                    },
                    success: function (result) {
                        
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        toastr.error(errorThrown);
                    },
                    complete: function () {
                        $("#btn-submit").removeClass("d-none");
                        $("#wating-section").addClass("d-none");
                    }
                });
            });
        });
    </script>
}
